---
title: R - 데이터 조작 2
date: 2019-03-20 22:55:14
tags:
  - R
---

## 01 데이터 처리 및 가공 패키지

R의 기본함수들도 충분히 훌륭하지만 실제 데이터를 다루기에는 편의성과 성능이 부족하다. 그러므로 데이터를 다루는데 더 나은 패키지들을 알아보자

## 02 SQL을 사용한 데이터 처리

sqldf는 SQL 명령이 주어지면 자동으로 스키마를 생성하고 데이터를 테이블로 로드한 뒤 SQL문을 수행한다. 그리고 SQL의 실행 결과는 다시 R로 로드된다.

```R
sqldf: 데이터 프레임에 SQL SELECT 질의를 수행한다.
sqldf(
  x, # sql select문
  stringsAsFactors=FALSE # 문자열을 팩터로 반환할지 또는 문자열로 반환할지 여부
)
반환 값은 데이터 프레임이다.
```

sqldf를 사용하려면 다음과 같이 패키지를 설치한다.

```R
> install.packages("sqldf")
> library(sqldf)
```

sqldf()를 사용해 아이리스 데이터를 살펴보자. iris에는 세 종류의 붓꽃 종류가 저장되어 있으며 붓꽃 종은 Species컬럼에 저장되어 있다.

```r
> sqldf("select distinct Species from iris")
     Species
1     setosa
2 versicolor
3  virginica
```

이번에는 setosa에 속하는 데이터에서 Sepal.Length의 평균을 구해보자.

```r
> sqldf('select avg("Sepal.Length") from iris where Species="setosa"')
  avg("Sepal.Length")
1               5.006
```

sqldf는 다양한 저장소를 사용할 수 있으며 기본 데이터 저장소로는 sqlite를 사용한다. 따라서 속도 향상을 위한 인덱스 등을 적절히 사용할 수도 있으며, 데이터베이스 기반 기술을 활용하므로 프로그램의 속도를 매우 빠르게 높일 수 있다.

## 03 분할, 적용, 재조합을 통한 데이터 분석

plyr 패키지는 데이터를 분할하고, 분할된 데이터에 특정 함수를 적용한 뒤, 그 결과를 재조합 하는 세 단계로 데이터를 처리하는 함수들을 제공한다.

plyr의 데이터 처리 함수들은 {adl}{adl*}ply 형태의 5글자 함수명을 사용한다. 첫 번째 글자는 입력 데이터 타입에 따라 각각 배열(a), 데이터 프레임(d), 리스트(l)로 정해진다. 두번째 글자는 출력 데이터 타입으로 a,d,l 또는* 로 정해지는데 이중 \_는 아무 출력도 없는것이다.

| 문자 | 용도       | 의미               |
| ---- | ---------- | ------------------ |
| a    | 입력, 출력 | 배열               |
| d    | 입력, 출력 | 데이터 프레임      |
| l    | 입력, 출력 | 리스트             |
| \_   | 출력       | 아무런 출력도 없음 |

plyr에는 이외에도 데이터프레임 또는 배열을 입력으로 받고 a,d,p,_ 유형의 출력을 지원하는 m{adp_}ply() 형태의 특별한 함수들이 있다.

### 패키지 설치

```r
> install.packages("plyr")
> library(plyr)
```

### adply()

```r
adply: 배열을 분할하고 함수를 적용한 뒤 결과를 데이터 프레임으로 반환한다.
adply(
  .data, # 행렬, 배열, 또는 데이터 프레임
  # 함수를 적용할 방향. 1(행 방향), 2(컬럼 방향) 또는 c(1, 2) (행과 컬럼 모두의 방향을 지정할 수 있다.)
  .margins,
  .fun=NULL # .margin 방
)
```
